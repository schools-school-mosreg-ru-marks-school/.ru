var requirejs,require,define;(function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.6",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!!(typeof window!=="undefined"&&navigator&&window.document),isWebWorker=!isBrowser&&typeof importScripts!=="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!=="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=false;function isFunction(a){return ostring.call(a)==="[object Function]"}function isArray(a){return ostring.call(a)==="[object Array]"}function each(a,b){if(a){var c;for(c=0;c<a.length;c+=1){if(a[c]&&b(a[c],c,a)){break}}}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1;c-=1){if(a[c]&&b(a[c],c,a)){break}}}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a){if(hasProp(a,c)){if(b(a[c],c)){break}}}}function mixin(a,b,c,d){if(b){eachProp(b,function(b,e){if(c||!hasProp(a,e)){if(d&&typeof b!=="string"){if(!a[e]){a[e]={}}mixin(a[e],b,c,d)}else{a[e]=b}}})}return a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a){return a}var b=global;each(a.split("."),function(a){b=b[a]});return b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);e.requireType=a;e.requireModules=d;if(c){e.originalError=c}return e}if(typeof define!=="undefined"){return}if(typeof requirejs!=="undefined"){if(isFunction(requirejs)){return}cfg=requirejs;requirejs=undefined}if(typeof require!=="undefined"&&!isFunction(require)){cfg=require;require=undefined}function newContext(a){var b,c,d,e,f,g={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},h={},i={},j={},k=[],l={},m={},n=1,o=1;function p(a){var b,c;for(b=0;a[b];b+=1){c=a[b];if(c==="."){a.splice(b,1);b-=1}else if(c===".."){if(b===1&&(a[2]===".."||a[0]==="..")){break}else if(b>0){a.splice(b-1,2);b-=2}}}}function q(a,b,c){var d,e,f,h,i,j,k,l,m,n,o,q=b&&b.split("/"),r=q,s=g.map,t=s&&s["*"];if(a&&a.charAt(0)==="."){if(b){if(getOwn(g.pkgs,b)){r=q=[b]}else{r=q.slice(0,q.length-1)}a=r.concat(a.split("/"));p(a);e=getOwn(g.pkgs,d=a[0]);a=a.join("/");if(e&&a===d+"/"+e.main){a=d}}else if(a.indexOf("./")===0){a=a.substring(2)}}if(c&&s&&(q||t)){h=a.split("/");for(i=h.length;i>0;i-=1){k=h.slice(0,i).join("/");if(q){for(j=q.length;j>0;j-=1){f=getOwn(s,q.slice(0,j).join("/"));if(f){f=getOwn(f,k);if(f){l=f;m=i;break}}}}if(l){break}if(!n&&t&&getOwn(t,k)){n=getOwn(t,k);o=i}}if(!l&&n){l=n;m=o}if(l){h.splice(0,m,l);a=h.join("/")}}return a}function r(a){if(isBrowser){each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===d.contextName){b.parentNode.removeChild(b);return true}})}}function s(a){var b=getOwn(g.paths,a);if(b&&isArray(b)&&b.length>1){r(a);b.shift();d.require.undef(a);d.require([a]);return true}}function t(a){var b,c=a?a.indexOf("!"):-1;if(c>-1){b=a.substring(0,c);a=a.substring(c+1,a.length)}return[b,a]}function u(a,b,c,e){var f,g,h,i,j=null,k=b?b.name:null,m=a,p=true,r="";if(!a){p=false;a="_@r"+(n+=1)}i=t(a);j=i[0];a=i[1];if(j){j=q(j,k,e);g=getOwn(l,j)}if(a){if(j){if(g&&g.normalize){r=g.normalize(a,function(a){return q(a,k,e)})}else{r=q(a,k,e)}}else{r=q(a,k,e);i=t(r);j=i[0];r=i[1];c=true;f=d.nameToUrl(r)}}h=j&&!g&&!c?"_unnormalized"+(o+=1):"";return{prefix:j,name:r,parentMap:b,unnormalized:!!h,url:f,originalName:m,isDefine:p,id:(j?j+"!"+r:r)+h}}function v(a){var b=a.id,c=getOwn(h,b);if(!c){c=h[b]=new d.Module(a)}return c}function w(a,b,c){var d=a.id,e=getOwn(h,d);if(hasProp(l,d)&&(!e||e.defineEmitComplete)){if(b==="defined"){c(l[d])}}else{e=v(a);if(e.error&&b==="error"){c(e.error)}else{e.on(b,c)}}}function x(a,b){var c=a.requireModules,d=false;if(b){b(a)}else{each(c,function(b){var c=getOwn(h,b);if(c){c.error=a;if(c.events.error){d=true;c.emit("error",a)}}});if(!d){req.onError(a)}}}function y(){if(globalDefQueue.length){apsp.apply(k,[k.length-1,0].concat(globalDefQueue));globalDefQueue=[]}}e={require:function(a){if(a.require){return a.require}else{return a.require=d.makeRequire(a.map)}},exports:function(a){a.usingExports=true;if(a.map.isDefine){if(a.exports){return a.exports}else{return a.exports=l[a.map.id]={}}}},module:function(a){if(a.module){return a.module}else{return a.module={id:a.map.id,uri:a.map.url,config:function(){var b,c=getOwn(g.pkgs,a.map.id);b=c?getOwn(g.config,a.map.id+"/"+c.main):getOwn(g.config,a.map.id);return b||{}},exports:l[a.map.id]}}}};function z(a){delete h[a];delete i[a]}function A(a,b,c){var d=a.map.id;if(a.error){a.emit("error",a.error)}else{b[d]=true;each(a.depMaps,function(d,e){var f=d.id,g=getOwn(h,f);if(g&&!a.depMatched[e]&&!c[f]){if(getOwn(b,f)){a.defineDep(e,l[f]);a.check()}else{A(g,b,c)}}});c[d]=true}}function B(){var a,c,e,h,j=g.waitSeconds*1e3,k=j&&d.startTime+j<(new Date).getTime(),l=[],m=[],n=false,o=true;if(b){return}b=true;eachProp(i,function(b){a=b.map;c=a.id;if(!b.enabled){return}if(!a.isDefine){m.push(b)}if(!b.error){if(!b.inited&&k){if(s(c)){h=true;n=true}else{l.push(c);r(c)}}else if(!b.inited&&b.fetched&&a.isDefine){n=true;if(!a.prefix){return o=false}}}});if(k&&l.length){e=makeError("timeout","Load timeout for modules: "+l,null,l);e.contextName=d.contextName;return x(e)}if(o){each(m,function(a){A(a,{},{})})}if((!k||h)&&n){if((isBrowser||isWebWorker)&&!f){f=setTimeout(function(){f=0;B()},50)}}b=false}c=function(a){this.events=getOwn(j,a.id)||{};this.map=a;this.shim=getOwn(g.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};c.prototype={init:function(a,b,c,d){d=d||{};if(this.inited){return}this.factory=b;if(c){this.on("error",c)}else if(this.events.error){c=bind(this,function(a){this.emit("error",a)})}this.depMaps=a&&a.slice(0);this.errback=c;this.inited=true;this.ignore=d.ignore;if(d.enabled||this.enabled){this.enable()}else{this.check()}},defineDep:function(a,b){if(!this.depMatched[a]){this.depMatched[a]=true;this.depCount-=1;this.depExports[a]=b}},fetch:function(){if(this.fetched){return}this.fetched=true;d.startTime=(new Date).getTime();var a=this.map;if(this.shim){d.makeRequire(this.map,{enableBuildCallback:true})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()}))}else{return a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;if(!m[a]){m[a]=true;d.load(this.map.id,a)}},check:function(){if(!this.enabled||this.enabling){return}var a,b,c=this.map.id,e=this.depExports,f=this.exports,g=this.factory;if(!this.inited){this.fetch()}else if(this.error){this.emit("error",this.error)}else if(!this.defining){this.defining=true;if(this.depCount<1&&!this.defined){if(isFunction(g)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError){try{f=d.execCb(c,g,e,f)}catch(b){a=b}}else{f=d.execCb(c,g,e,f)}if(this.map.isDefine){b=this.module;if(b&&b.exports!==undefined&&b.exports!==this.exports){f=b.exports}else if(f===undefined&&this.usingExports){f=this.exports}}if(a){a.requireMap=this.map;a.requireModules=this.map.isDefine?[this.map.id]:null;a.requireType=this.map.isDefine?"define":"require";return x(this.error=a)}}else{f=g}this.exports=f;if(this.map.isDefine&&!this.ignore){l[c]=f;if(req.onResourceLoad){req.onResourceLoad(d,this.map,this.depMaps)}}z(c);this.defined=true}this.defining=false;if(this.defined&&!this.defineEmitted){this.defineEmitted=true;this.emit("defined",this.exports);this.defineEmitComplete=true}}},callPlugin:function(){var a=this.map,b=a.id,c=u(a.prefix);this.depMaps.push(c);w(c,"defined",bind(this,function(c){var e,f,i,j=this.map.name,k=this.map.parentMap?this.map.parentMap.name:null,l=d.makeRequire(a.parentMap,{enableBuildCallback:true});if(this.map.unnormalized){if(c.normalize){j=c.normalize(j,function(a){return q(a,k,true)})||""}f=u(a.prefix+"!"+j,this.map.parentMap);w(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:true,ignore:true})}));i=getOwn(h,f.id);if(i){this.depMaps.push(f);if(this.events.error){i.on("error",bind(this,function(a){this.emit("error",a)}))}i.enable()}return}e=bind(this,function(a){this.init([],function(){return a},null,{enabled:true})});e.error=bind(this,function(a){this.inited=true;this.error=a;a.requireModules=[b];eachProp(h,function(a){if(a.map.id.indexOf(b+"_unnormalized")===0){z(a.map.id)}});x(a)});e.fromText=bind(this,function(c,f){var h=a.name,i=u(h),j=useInteractive;if(f){c=f}if(j){useInteractive=false}v(i);if(hasProp(g.config,b)){g.config[h]=g.config[b]}try{req.exec(c)}catch(a){return x(makeError("fromtexteval","fromText eval for "+b+" failed: "+a,a,[b]))}if(j){useInteractive=true}this.depMaps.push(i);d.completeLoad(h);l([h],e)});c.load(a.name,l,e,g)}));d.enable(c,this);this.pluginMaps[c.id]=c},enable:function(){i[this.map.id]=this;this.enabled=true;this.enabling=true;each(this.depMaps,bind(this,function(a,b){var c,f,g;if(typeof a==="string"){a=u(a,this.map.isDefine?this.map:this.map.parentMap,false,!this.skipMap);this.depMaps[b]=a;g=getOwn(e,a.id);if(g){this.depExports[b]=g(this);return}this.depCount+=1;w(a,"defined",bind(this,function(a){this.defineDep(b,a);this.check()}));if(this.errback){w(a,"error",bind(this,this.errback))}}c=a.id;f=h[c];if(!hasProp(e,c)&&f&&!f.enabled){d.enable(a,this)}}));eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(h,a.id);if(b&&!b.enabled){d.enable(a,this)}}));this.enabling=false;this.check()},on:function(a,b){var c=this.events[a];if(!c){c=this.events[a]=[]}c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)});if(a==="error"){delete this.events[a]}}};function C(a){if(!hasProp(l,a[0])){v(u(a[0],null,true)).init(a[1],a[2])}}function D(a,b,c,d){if(a.detachEvent&&!isOpera){if(d){a.detachEvent(d,b)}}else{a.removeEventListener(c,b,false)}}function E(a){var b=a.currentTarget||a.srcElement;D(b,d.onScriptLoad,"load","onreadystatechange");D(b,d.onScriptError,"error");return{node:b,id:b&&b.getAttribute("data-requiremodule")}}function F(){var a;y();while(k.length){a=k.shift();if(a[0]===null){return x(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]))}else{C(a)}}}d={config:g,contextName:a,registry:h,defined:l,urlFetched:m,defQueue:k,Module:c,makeModuleMap:u,nextTick:req.nextTick,onError:x,configure:function(a){if(a.baseUrl){if(a.baseUrl.charAt(a.baseUrl.length-1)!=="/"){a.baseUrl+="/"}}var b=g.pkgs,c=g.shim,e={paths:true,config:true,map:true};eachProp(a,function(a,b){if(e[b]){if(b==="map"){if(!g.map){g.map={}}mixin(g[b],a,true,true)}else{mixin(g[b],a,true)}}else{g[b]=a}});if(a.shim){eachProp(a.shim,function(a,b){if(isArray(a)){a={deps:a}}if((a.exports||a.init)&&!a.exportsFn){a.exportsFn=d.makeShimExports(a)}c[b]=a});g.shim=c}if(a.packages){each(a.packages,function(a){var c;a=typeof a==="string"?{name:a}:a;c=a.location;b[a.name]={name:a.name,location:c||a.name,main:(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}});g.pkgs=b}eachProp(h,function(a,b){if(!a.inited&&!a.map.unnormalized){a.map=u(b)}});if(a.deps||a.callback){d.require(a.deps||[],a.callback)}},makeShimExports:function(a){function b(){var b;if(a.init){b=a.init.apply(global,arguments)}return b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,c){c=c||{};function f(g,i,j){var k,m,n;if(c.enableBuildCallback&&i&&isFunction(i)){i.__requireJsBuild=true}if(typeof g==="string"){if(isFunction(i)){return x(makeError("requireargs","Invalid require call"),j)}if(b&&hasProp(e,g)){return e[g](h[b.id])}if(req.get){return req.get(d,g,b,f)}m=u(g,b,false,true);k=m.id;if(!hasProp(l,k)){return x(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))}return l[k]}F();d.nextTick(function(){F();n=v(u(null,b));n.skipMap=c.skipMap;n.init(g,i,j,{enabled:true});B()});return f}mixin(f,{isBrowser:isBrowser,toUrl:function(a){var c,e=a.lastIndexOf("."),f=a.split("/")[0],g=f==="."||f==="..";if(e!==-1&&(!g||e>1)){c=a.substring(e,a.length);a=a.substring(0,e)}return d.nameToUrl(q(a,b&&b.id,true),c,true)},defined:function(a){return hasProp(l,u(a,b,false,true).id)},specified:function(a){a=u(a,b,false,true).id;return hasProp(l,a)||hasProp(h,a)}});if(!b){f.undef=function(a){y();var c=u(a,b,true),d=getOwn(h,a);delete l[a];delete m[c.url];delete j[a];if(d){if(d.events.defined){j[a]=d.events}z(a)}}}return f},enable:function(a){var b=getOwn(h,a.id);if(b){v(a).enable()}},completeLoad:function(a){var b,c,d,e=getOwn(g.shim,a)||{},f=e.exports;y();while(k.length){c=k.shift();if(c[0]===null){c[0]=a;if(b){break}b=true}else if(c[0]===a){b=true}C(c)}d=getOwn(h,a);if(!b&&!hasProp(l,a)&&d&&!d.inited){if(g.enforceDefine&&(!f||!getGlobal(f))){if(s(a)){return}else{return x(makeError("nodefine","No define call for "+a,null,[a]))}}else{C([a,e.deps||[],e.exportsFn])}}B()},nameToUrl:function(a,b,c){var d,e,f,h,i,j,k,l,m;if(req.jsExtRegExp.test(a)){l=a+(b||"")}else{d=g.paths;e=g.pkgs;i=a.split("/");for(j=i.length;j>0;j-=1){k=i.slice(0,j).join("/");f=getOwn(e,k);m=getOwn(d,k);if(m){if(isArray(m)){m=m[0]}i.splice(0,j,m);break}else if(f){if(a===f.name){h=f.location+"/"+f.main}else{h=f.location}i.splice(0,j,h);break}}l=i.join("/");l+=b||(/\?/.test(l)||c?"":".js");l=(l.charAt(0)==="/"||l.match(/^[\w\+\.\-]+:/)?"":g.baseUrl)+l}return g.urlArgs?l+((l.indexOf("?")===-1?"?":"&")+g.urlArgs):l},load:function(a,b){req.load(d,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if(a.type==="load"||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=E(a);d.completeLoad(b.id)}},onScriptError:function(a){var b=E(a);if(!s(b.id)){return x(makeError("scripterror","Script error for: "+b.id,a,[b.id]))}}};d.require=d.makeRequire();return d}req=requirejs=function(a,b,c,d){var e,f,g=defContextName;if(!isArray(a)&&typeof a!=="string"){f=a;if(isArray(b)){a=b;b=c;c=d}else{a=[]}}if(f&&f.context){g=f.context}e=getOwn(contexts,g);if(!e){e=contexts[g]=req.s.newContext(g)}if(f){e.configure(f)}return e.require(a,b,c)};req.config=function(a){return req(a)};req.nextTick=typeof setTimeout!=="undefined"?function(a){setTimeout(a,4)}:function(a){a()};if(!require){require=req}req.version=version;req.jsExtRegExp=/^\/|:|\?|\.js$/;req.isBrowser=isBrowser;s=req.s={contexts:contexts,newContext:newContext};req({});each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}});if(isBrowser){head=s.head=document.getElementsByTagName("head")[0];baseElement=document.getElementsByTagName("base")[0];if(baseElement){head=s.head=baseElement.parentNode}}req.onError=defaultOnError;req.load=function(a,b,c){var d=a&&a.config||{},e;if(isBrowser){e=d.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");e.type=d.scriptType||"text/javascript";e.charset="utf-8";e.async=true;e.setAttribute("data-requirecontext",a.contextName);e.setAttribute("data-requiremodule",b);if(e.attachEvent&&!(e.attachEvent.toString&&e.attachEvent.toString().indexOf("[native code")<0)&&!isOpera){useInteractive=true;e.attachEvent("onreadystatechange",a.onScriptLoad)}else{e.addEventListener("load",a.onScriptLoad,false);e.addEventListener("error",a.onScriptError,false)}e.src=c;currentlyAddingScript=e;if(baseElement){head.insertBefore(e,baseElement)}else{head.appendChild(e)}currentlyAddingScript=null;return e}else if(isWebWorker){try{importScripts(c);a.completeLoad(b)}catch(d){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,d,[b]))}}};function getInteractiveScript(){if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript}eachReverse(scripts(),function(a){if(a.readyState==="interactive"){return interactiveScript=a}});return interactiveScript}if(isBrowser){eachReverse(scripts(),function(a){if(!head){head=a.parentNode}dataMain=a.getAttribute("data-main");if(dataMain){mainScript=dataMain;if(!cfg.baseUrl){src=mainScript.split("/");mainScript=src.pop();subPath=src.length?src.join("/")+"/":"./";cfg.baseUrl=subPath}mainScript=mainScript.replace(jsSuffixRegExp,"");if(req.jsExtRegExp.test(mainScript)){mainScript=dataMain}cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript];return true}})}define=function(a,b,c){var d,e;if(typeof a!=="string"){c=b;b=a;a=null}if(!isArray(b)){c=b;b=null}if(!b&&isFunction(c)){b=[];if(c.length){c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)});b=(c.length===1?["require"]:["require","exports","module"]).concat(b)}}if(useInteractive){d=currentlyAddingScript||getInteractiveScript();if(d){if(!a){a=d.getAttribute("data-requiremodule")}e=contexts[d.getAttribute("data-requirecontext")]}}(e?e.defQueue:globalDefQueue).push([a,b,c])};define.amd={jQuery:true};req.exec=function(text){return eval(text)};req(cfg)})(this);define("common/dnevnik",[],function(){"use strict";var a=window.dnevnik||{};a.namespace=function(b){var c=a,d=b.split("."),e,f;if(d[0]==="dnevnik"){d=d.slice(1)}for(e=0,f=d.length;e<f;e+=1){if(typeof c[d[e]]==="undefined"){c[d[e]]={}}c=c[d[e]]}return c};window.dnevnik=a;window.yandex_metrika_callbacks=window.yandex_metrika_callbacks||[];return a});define("common/pubsub",[],function(){"use strict";var a=dnevnik.pubsub={};a.subscribers={};a.subscribe=function(a,b){if(!this.subscribers[a]){this.subscribers[a]=[]}this.subscribers[a].push(b)};a.publish=function(a,b){var c=this.subscribers[a],d,e;if(!c){return}for(d=0,e=c.length;d<e;d+=1){c[d](b)}}});define("analytics/service",["common/dnevnik"],function(){"use strict";var a=arguments[0];return function b(){var c=arguments[0];(function(a,b,c,d,e,f,g){a["GoogleAnalyticsObject"]=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date;f=b.createElement(c),g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)})(window,document,"script",c,"_ga");this.settings=a.settings;this.urls=a.urls;this.user=a.user}});define("analytics/googletracker",[],function(){"use strict";function a(a,b,c,d){var e=window._ga;var f=c!==undefined?c+".":"";e(f+"set","dimension1",a.sex);e(f+"set","dimension2",a.age.toString());e(f+"set","dimension3",a.role);if(b){e(f+"set","dimension4",b.id.toString())}else{e(f+"set","dimension4","-1")}if(a.children){var g=a.children[0];if(g){e(f+"set","dimension5",g.age.toString());if(g.sex==="Male"){e(f+"set","dimension8","Boy")}else{e(f+"set","dimension8","Girl")}}}if(typeof useAdBlock==="undefined"){e(f+"set","dimension6","Use")}else{e(f+"set","dimension6","NotUse")}e(f+"set","dimension7",a.id.toString());if(b){e(f+"set","dimension9",b.regionName)}else{e(f+"set","dimension9","-1")}if(d){e(f+"set","dimension10",d)}}function b(a,b){var c=document.location;var d=c.host.split(".")[0];return a.some(function(a){return d===a})||b.some(function(a){return c.pathname.indexOf(a)>-1})}return function c(d){var e={googleAnalyticsId:d.googleAnalyticsId,isDefault:d.isDefault,isAddition:d.isAddition,hosts:d.hosts===undefined?[]:d.hosts,urls:d.urls===undefined?[]:d.urls,name:d.name,isAppropriate:b(d.hosts===undefined?[]:d.hosts,d.urls===undefined?[]:d.urls),sampleRate:d.sampleRate===undefined?100:d.sampleRate,track:function(b,c,d,e){if(this.name!==undefined){b("create",this.googleAnalyticsId,"auto",this.name,c?{userId:c.id.toString(),sampleRate:this.sampleRate}:{sampleRate:this.sampleRate})}else{b("create",this.googleAnalyticsId,"auto",c?{userId:c.id.toString(),sampleRate:this.sampleRate}:{sampleRate:this.sampleRate})}var f=this.name!==undefined?this.name+".require":"require";b(f,"displayfeatures");b(f,"ec");if(c){a(c,d,this.name,e)}var g=this.name!==undefined?this.name+".send":"send";b(g,"pageview")}};return e}});define("analytics/google",["analytics/service","analytics/googletracker"],function(){"use strict";var a=arguments[0],b=arguments[1],c;c=new a("//www.google-analytics.com/analytics.js");c.init=function(){var a=[new b({googleAnalyticsId:this.settings.googleAnalytics.defaultId,isDefault:true,isAddition:false}),new b({googleAnalyticsId:this.settings.googleAnalytics.appsId,isDefault:false,isAddition:false,hosts:["apps"],urls:["/subscriptions"],name:"apps"}),new b({googleAnalyticsId:this.settings.googleAnalytics.appSubscriptionId,isDefault:false,isAddition:false,urls:["/subscriptions"]}),new b({googleAnalyticsId:this.settings.googleAnalytics.schoolPaymentsId,isAddition:true,urls:["/schoolpayments","/schoolpayments/history","/hc/ru/articles/205646348"],name:"schoolpayments"}),new b({googleAnalyticsId:this.settings.googleAnalytics.adId,isAddition:true,hosts:["ad"],name:"ad"}),new b({googleAnalyticsId:this.settings.googleAnalytics.childrenId,isAddition:true,hosts:["children"],name:"children"}),new b({googleAnalyticsId:this.settings.googleAnalytics.contactId,isAddition:true,hosts:["contact"],name:"contact"}),new b({googleAnalyticsId:this.settings.googleAnalytics.eventsId,isAddition:true,hosts:["events"],name:"events"}),new b({googleAnalyticsId:this.settings.googleAnalytics.groupsId,isAddition:true,hosts:["groups"],name:"groups"}),new b({googleAnalyticsId:this.settings.googleAnalytics.loginId,isAddition:true,hosts:["login"],name:"login"}),new b({googleAnalyticsId:this.settings.googleAnalytics.messengerId,isAddition:true,hosts:["messenger"],name:"messenger"}),new b({googleAnalyticsId:this.settings.googleAnalytics.networksId,isAddition:true,hosts:["networks"],name:"networks"}),new b({googleAnalyticsId:this.settings.googleAnalytics.peopleId,isAddition:true,hosts:["people"],name:"people"}),new b({googleAnalyticsId:this.settings.googleAnalytics.schoolsId,isAddition:true,hosts:["schools"],name:"schools"}),new b({googleAnalyticsId:this.settings.googleAnalytics.wikiId,isAddition:true,hosts:["wiki"],name:"wiki"}),new b({googleAnalyticsId:this.settings.googleAnalytics.appsId,isDefault:false,isAddition:false,hosts:["tests"],name:"tests"}),new b({googleAnalyticsId:this.settings.googleAnalytics.appsId,isDefault:false,isAddition:false,hosts:["lib"],name:"lib"})];var c=false;a.sort(function(a,b){return a.isDefault<b.isDefault?-1:1});var d=window._ga;var e=this.user;var f=null;var g=null;if(e){f=e.schools&&e.schools[0]?e.schools[0]:null;g=e.subscriptionPaymentType}var h=false;a.forEach(function(a){if(a.isAddition){if(a.isAppropriate){a.track(d,e,f,g);h=true}}else{if(!a.isDefault&&a.isAppropriate){a.track(d,e,f,g);c=true}if(a.isDefault&&c===false){a.track(d,e,f,g);c=true}}});if(!h){var i=new b({googleAnalyticsId:this.settings.googleAnalytics.mainId,name:"main"});i.track(d,e,f,g)}var j=new b({googleAnalyticsId:this.settings.googleAnalytics.limitedCounterId,sampleRate:this.settings.googleAnalytics.limitedCounterSampleRate,name:"limited"});j.track(d,e,f,g)};c.track=function(a){var b;if(a.nonInteraction){b={nonInteraction:true}}window._ga("send","event",a.category,a.action,a.label,a.value,b)};c.trackUrl=function(a){window._ga("send","pageview",a.pageView)};return c});define("analytics/events",["common/dnevnik"],function(){"use strict";$.fn.live=$.fn.live||$.fn.on;$(document).ready(function(){$(".trackable").live("click",function(a){var b=a.currentTarget,c=b.getAttribute("data-id"),d=b.getAttribute("data-action"),e=b.getAttribute("data-category");dnevnik.analytics.track({category:e,action:d,label:c})})})});define("analytics/yaMetrikaTracker",[],function(){"use strict";return function(a){var b=a.target,c=dnevnik.settings.yandexMetrikaId;if(b){var d=window["yaCounter"+c];if(d&&d.reachGoal){d.reachGoal(b)}}}});define("analytics/analytics",["common/dnevnik","analytics/google","analytics/events","analytics/yaMetrikaTracker"],function(){"use strict";var a=arguments[0],b=arguments[1],c=arguments[3];a.namespace("dnevnik.analytics");a.analytics=function(){b.init();return{track:function(a){if(b.track){b.track(a)}},trackUrl:function(a){if(b.trackUrl){b.trackUrl(a)}},yandex:{reachGoal:function(a){c(a)}}}}()});define("dialogs/dialogs",["common/dnevnik"],function(){"use strict";var a="popupNotification";var b=30;var c=4e3;var d=arguments[0];d.namespace("dnevnik.dialogs");d.dialogs=function(){var d=function(d,g,h){var i;if(h>0){c=h}if(Array.isArray(d)){i=d}else{try{i=JSON.parse(d).map(function(a){return a.errors})}catch(a){i=[d]}}$("."+a).remove();var j=0;for(var k=0;k<i.length;k+=1){var l=e(i[k],g);f(l,j);j+=l.height()+b}};var e=function(b,c){return $("<div>").addClass("popup-dialog").addClass(c).addClass(a).html(b)};var f=function(a,b){var d=$(window);$("body").append(a);a.offset({top:a.offset().top+d.scrollTop()+b,left:(d.width()-a.width())/2});a.fadeIn().delay(c).fadeOut(0,function(){$(this).remove()})};return{message:function(){d(arguments[0],"popup-dialog_message")},error:function(){d(arguments[0],"popup-dialog_error",arguments[1])}}}()});define("messageBox/messageBox",["common/dnevnik"],function(a){"use strict";a.namespace("dnevnik.messageBox");a.messageBox=function(){var a=$("#errors");var b=$(".messages");var c=function(b){a.removeAttr("style");var c=a.find("div.c1");a.find("div.cc").remove();c.after($(b))};var d=function(a){b.removeAttr("style");var c=b.find("#success_message");c.html(a)};var e=function(){b.attr("style","display:none")};var f=function(){a.attr("style","display:none")};return{showErrorMsg:function(a){c(a)},showSuccessMsg:function(a){d(a)},hideSuccessMsg:function(){e()},hideErrorMsg:function(){f()}}}()});define("utils/string",[],function(){"use strict";var a=function(){var a=arguments,b=a[0],c=a.length-1;return b.replace(/\{[0-9]+\}/g,function(b){var d=parseInt(b.substring(1,b.length-1),10);return d>=0&&d<c?a[d+1]:""})};var b=function(a){return $("<div/>").text(a).html()};var c=function(a){return $("<div/>").html(a).text()};var d=function(a){return a===null||a.match(/^\s*$/)!==null};return{format:a,encode:b,decode:c,isEmptyOrSpaces:d}});define("utils/linkify",[],function(){"use strict";var a="[a-z\\d.-]+://",b="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",c="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",d="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|рф|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--p1ai|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",e="(?:"+c+d+"|"+b+")",f="(?:[;/][^#?<>\\s]*)?",g="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",h=a+"[^<>\\s]+",i=e+f+g+"(?!\\w)",j="mailto:",k="(?:"+j+")?[a-zа-я0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-zф-я0-9!#$%&'*+/=?^_`{|}~-]+)*@"+e+g+"(?!\\w)",l=new RegExp("(?:"+h+"|"+i+"|"+k+")","ig"),m=new RegExp("^"+a,"i"),n={"'":"`",">":"<",")":"(","]":"[","}":"{","»":"«","›":"‹"},o={callback:function(a,b){return b?'<a href="'+b+'" title="'+b+'">'+a+"</a>":a},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(a,b,c){b=b||{};var d,e,f,g,h="",i=[],k,p,q,r,s,t,u,v,w=function(a){p-=a.length;return""};for(e in o){if(o.hasOwnProperty(e)&&b[e]===undefined){b[e]=o[e]}}while(d=l.exec(a)){f=d[0];p=l.lastIndex;q=p-f.length;if(/[\/:]/.test(a.charAt(q-1))){continue}do{r=f;v=f.substr(-1);u=n[v];if(u){s=f.match(new RegExp("\\"+u+"(?!$)","g"));t=f.match(new RegExp("\\"+v,"g"));if((s?s.length:0)<(t?t.length:0)){f=f.substr(0,f.length-1);p-=1}}if(b.punct_regexp){f=f.replace(b.punct_regexp,w)}}while(f.length&&f!==r);g=f;if(!m.test(g)){g=(g.indexOf("@")!==-1?!g.indexOf(j)?"":j:!g.indexOf("irc.")?"irc://":!g.indexOf("ftp.")?"ftp://":"http://")+g}if(k!==q){i.push([a.slice(k,q)]);k=p}i.push([f,g]);if(c){break}}i.push([a.substr(k)]);for(e=0;e<i.length;e+=1){h+=b.callback.apply(window,i[e])}return h||a}});define("utils/guid",[],function(){"use strict";return{set:function(){var a;if(arguments.length===1){if(this.isValid(arguments[0])){a=arguments[0]}else{a=this.empty()}}$(this).data("value",a);return a},empty:function(){return"00000000-0000-0000-0000-000000000000"},isEmpty:function(a){return a===this.empty()||!a},isValid:function(a){var b=/\\b(?:[A-F0-9]{8})(?:-[A-F0-9]{4}){3}-(?:[A-F0-9]{12})\\b/;return b.exec(a)!==null},getNew:function(){if(arguments.length===1&&this.isValid(arguments[0])){$(this).data("value",arguments[0]);return arguments[0]}var a=[],b,c;var d=/[2345]/;for(var e=0;e<8;e+=1){b=((1+Math.random())*65536|0).toString(16).substring(1);if(d.exec(e.toString())!==null){if(e===3){b="6"+b.substr(1,3)}a.push("-")}a.push(b.toUpperCase())}c=a.join("");$(this).data("value",c);return c},value:function(){if($(this).data("value")){return $(this).data("value")}var a=this.getNew();$(this).data("value",a);return a}}});define("utils/preventdoubleclick",[],function(){"use strict";return function(a){$.fn.live=$.fn.live||$.fn.on;$(a).live("submit",function(a){var b=$(this);b.find(":input").addClass("disabled");if(b.data("submitted")===true){a.preventDefault()}else{b.data("submitted",true)}})}});!function(a,b){"use strict";if(typeof module!=="undefined"){module.exports=b()}else if(typeof define==="function"&&typeof define.amd==="object"){define("utils/domready",b)}else{this[a]=b()}}("utils/domready",function(){"use strict";var a=[],b,c=document,d=c.documentElement.doScroll,e="DOMContentLoaded",f=(d?/^loaded|^c/:/^loaded|^i|^c/).test(c.readyState);if(!f){c.addEventListener(e,b=function(){c.removeEventListener(e,b);f=1;while(b=a.shift()){b()}})}return function(b){f?setTimeout(b,0):a.push(b)}});define("utils/forcenumberinput",["utils/domready"],function(a){"use strict";return function(){var b=function(a){var b=this;var c=a;var d=c.classList.contains("forcenumber_real");var e=function(a,b){if(d){a=a.replace(",",".");if(isNaN(a)||Number(a)<0){b.preventDefault()}}else{var c=parseInt(a);var e=c+"";if(e.length<a.length||isNaN(c)&&!isFinite(c)){b.preventDefault()}}};b.Init=function(){c.addEventListener("paste",function(a){if(window.clipboardData&&window.clipboardData.getData){var b=window.clipboardData.getData("Text");e(b,a)}else if(a.clipboardData.getData){var c=a.clipboardData.getData("text/plain");e(c,a)}});c.addEventListener("keydown",function(a){if($.inArray(a.keyCode,[46,8,9,27,13])!==-1||a.ctrlKey===true||a.keyCode>=35&&a.keyCode<=40){return}if(d&&$.inArray(a.keyCode,[110,188,190])!==-1){return}if((a.shiftKey||(a.keyCode<48||a.keyCode>57))&&(a.keyCode<96||a.keyCode>105)){a.preventDefault()}})}};a(function(){var a=document.getElementsByClassName("forcenumber");for(var c=0;c<a.length;c+=1){new b(a[c]).Init()}});return b}()});define("utils/utils",["common/dnevnik","utils/string","utils/linkify","utils/guid","utils/preventdoubleclick","utils/forcenumberinput"],function(){"use strict";var a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3];a.namespace("dnevnik.utils");a.utils={string:b,linkify:c,guid:d,getCursorPositionInText:function(a){if(!a){return false}if("selectionStart"in a){return a.selectionStart}else if(document.selection){a.focus();var b=document.selection.createRange();b.moveStart("character",-a.value.length);return b.text.length}return false},getQueryParameter:function(a){var b=location.search.substr(1).split("&");var c=false;_.forEach(b,function(b){var d=b.split("=");if(d[0]===a){c=decodeURIComponent(d[1])}});return c},validateField:function(a){if(!a){return false}var b="error";if(typeof a==="string"){a=$("#"+a)}var c=a.val().trim();if(c===""){a.addClass(b);a.one("focus",function(){a.removeClass(b)});return false}return true}}});define("lazy/links",["utils/linkify","common/dnevnik","analytics/analytics"],function(){"use strict";var a=arguments;return function(){$.fn.live=$.fn.live||$.fn.on;var b=a[0],c=a[1].urls,d=c.domain,e=c.whiteList,f=c.moderate,g=a[2],h={callback:function(a,b){if(b){return j({text:a,href:b,isLocal:b.match(d),isWhite:k(b),isHref:false})}else{return a}}},i={callback:function(a,b){if(b){return j({text:a,href:b,isLocal:b.match(d),isWhite:k(b),isHref:true})}else{return a}}},j=function(a){var b=a.text,c=a.href,d=a.isLocal,e=a.isWhite,g=a.isHref;var h=!(d||e);if(h){if(f){c=f+"?link="+encodeURIComponent(c)+"&referer="+encodeURIComponent(window.location)}else{c=encodeURI(c)}}var i=c+'" title="'+b+'"';if(!d){i+=' class="outgoing"'}if(h){i+=' target="_blank"'}if(!g){i='<a href="'+i+">"+b+"</a>"}return i},k=function(a){for(var b=0,c=e.length;b<c;b+=1){if(_.unescape(a).indexOf(e[b])!==-1){return true}}return false},l=function(a){var c=a.nodeValue;$(a).replaceWith(b(_.escape(c),h,false))},m=function(a){var c=a.nodeValue;$(a).replaceWith(b(_.escape(c),i,true))},n=function(a,b){var c=+new Date;do{b(a.shift())}while(a.length>0&&+new Date-c<50);if(a.length>0){setTimeout(function(){n(a,b)},25)}};function o(){this.nodes=[];this.hrefNodes=[]}o.prototype.find=function(a){var b,c;if(!a){return}if(a.nodeType===Node.TEXT_NODE){if(/<a.*href=.*>/.test(a.nodeValue)){this.hrefNodes.push(a)}else if(!/^\s*$/.test(a.nodeValue)){this.nodes.push(a)}}else{for(b=0,c=a.childNodes.length;b<c;){this.find(a.childNodes[b]);b+=1}}};o.prototype.convertToLinks=function(){var a=this;if(this.nodes.length>0){setTimeout(function(){n(a.nodes,l)},25)}if(this.hrefNodes.length>0){setTimeout(function(){n(a.hrefNodes,m)},25)}$("a.outgoing").not(".analytics-tracked").each(function(){var a=$(this);a.live("click",function(){g.track({category:"Links",action:"Outgoing",label:this.href})});a.addClass("analytics-tracked")})};$(document).ready(function(){var a=new o;$("#content div.text, dl.info dd, ul.comments li:not(a,input)").each(function(b,c){a.find(c)});a.convertToLinks()});dnevnik.pubsub.subscribe("linkify-content-published",function(a){var b=new o;b.find(a);b.convertToLinks()})}});define("utils/gettextnodes",[],function(){"use strict";return function(a,b){var c=function(a,b){var c=[],d=/\S/;function e(a){if(a.nodeType===3){if(b||d.test(a.nodeValue)){c.push(a)}}else{for(var f=0,g=a.childNodes.length;f<g;f=f+1){e(a.childNodes[f])}}}e(a);return c};return c(a,b)}});define("smiles/smilesforpage",["utils/gettextnodes"],function(a){"use strict";return function(){emojione.imageType="png";emojione.imagePathPNG=dnevnik.urls.smilesSpriteUrl;emojione.ascii=true;var b=$(".smiles-enabled");b.each(function(){var b=$(this);var c=a(b[0]);$(c).each(function(){var a=$(this);a.replaceWith(emojione.toImage(_.escape(a.text())))})})}});define("smiles/smilesforeditor",["utils/gettextnodes"],function(a){"use strict";return function(b){emojione.imageType="png";emojione.imagePathPNG=b.smilesSpriteUrl;emojione.ascii=true;var c=function(b){var c=false;var d=$(b);d.each(function(){var b=$(this);var d=a(b[0]);$(d).each(function(){var a=$(this);var b=_.escape(a.text());var d=emojione.toImage(b);if(b!==d){a.replaceWith(d);c=true}})});var e=$("<div />").append(d);return{content:e.html(),contentChanged:c}};var d=function(a){var b=$(a);var c=b.find(".emojione");c.each(function(){var a=$(this);a.replaceWith(a.attr("alt"))});var d=$("<div>").append(b);return d.html()};return{convertTo:c,convertFrom:d}}});define("lazy/lazy",["lazy/links","smiles/smilesforpage","smiles/smilesforeditor"],function(a,b){"use strict";if(document.readyState!=="loading"){b();a()}else{document.addEventListener("DOMContentLoaded",function(){b();a()})}});define("controls/utils",["common/dnevnik"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.Dictionaries={BuildList:function(a){var b,c=['<option value="" >-  '+a.label+"  -</option>"];for(b=0;b<a.list.length;b+=1){c.push('<option value="'+a.list[b].Id+'" data-type="'+a.list[b].Type+'">'+a.list[b].Name+"</option>")}return c.join("")}}});define("controls/cityselectbox",["common/dnevnik","controls/utils"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.ChainedSelectInput=function(a){this.o=$.extend({},this.defaults,a);this.init()};dnevnik.common.controls.ChainedSelectInput.prototype={defaults:{el:null,next:null,change:null,label:"Загрузка...",ajaxUrl:null},init:function(){this._onChange=$.proxy(this.onChange,this);this._clear=$.proxy(this.clear,this);this._onParantChanged=$.proxy(this.onParantChanged,this);this._LoadList=$.proxy(this.LoadList,this);this.el=$(this.o.el+"_Select");this.next=$(this.o.next+"_Select");this.hidden=$(this.o.el);this.el.bind("change",this._onChange);this.el.bind("csi:parantchanged",this._onParantChanged);this.el.bind("csi:clear",this._clear)},onChange:function(a){this.hidden.val(this.el.val());var b=true;if(this.o.change){b=this.o.change(a,this)}if(b){this.next.trigger("csi:parantchanged",this.el.val())}},onParantChanged:function(a,b){if(b){this.LoadList(b,null);if(this.next){this.next.trigger("csi:clear")}}else{this.clear()}},LoadList:function(a,b,c){this.el.empty().attr("disabled","disabled").append('<option value="">'+this.o.label+"</option>").parent().show();var d=this;$.post(this.o.ajaxUrl,{id:a},function(a){d.el.html(dnevnik.common.controls.Dictionaries.BuildList(a)).removeAttr("disabled");if(b){var e=c?'option[value= "'+b+'"][data-type="'+c+'"]':'option[value= "'+b+'"]';d.el.find(e).attr("selected",true);d.hidden.val(b)}},"json")},clear:function(){this.hidden.val(null);this.el.empty().parent().hide();if(this.next){this.next.trigger("csi:clear")}}};dnevnik.common.controls.CitySelectBox=function(a){this.o=$.extend({},this.defaults,a);this.init(this.o)};dnevnik.common.controls.CitySelectBox.prototype={defaults:{ajaxUrl:null,baseElId:"CitySelectBox",label:"Загрузка...",useCityRegion:false},init:function(a){this.cityRegion=a.useCityRegion&&new dnevnik.common.controls.ChainedSelectInput({el:"#"+a.baseElId+"_CityRegionId",ajaxUrl:a.ajaxUrl+"/cityregionlist"});this.city=new dnevnik.common.controls.ChainedSelectInput({el:"#"+a.baseElId+"_CityId",next:a.useCityRegion?"#"+a.baseElId+"_CityRegionId":null,ajaxUrl:a.ajaxUrl+"/citylist"});var b=this;this.childRegion=new dnevnik.common.controls.ChainedSelectInput({el:"#"+a.baseElId+"_ChildRegionId",next:"#"+a.baseElId+"_CityId",ajaxUrl:a.ajaxUrl+"/cityandregionlist",change:function(c,d){var e=d.el.val();d.hidden.val(e);if(e&&d.el.find(":selected").data("type")==="city"){d.next.trigger("csi:clear");d.hidden.val(null);b.city.hidden.val(e);if(a.useCityRegion){b.cityRegion.el.trigger("csi:parantchanged",e)}return false}return true}});this.region=new dnevnik.common.controls.ChainedSelectInput({el:"#"+a.baseElId+"_RegionId",next:"#"+a.baseElId+"_ChildRegionId",ajaxUrl:a.ajaxUrl+"/regionlist"});this.country=new dnevnik.common.controls.ChainedSelectInput({el:"#"+a.baseElId+"_CountryId",next:"#"+a.baseElId+"_RegionId",ajaxUrl:a.ajaxUrl+"/countrylist"})},select:function(a){if(a.Visible===false){return}this.country.LoadList(null,a.CountryId);if(a.RegionId){this.region.LoadList(a.CountryId,a.RegionId)}if(a.ChildRegionId){this.childRegion.LoadList(a.RegionId,a.ChildRegionId,"region")}if(a.CityId){if(a.ChildRegionId){this.city.LoadList(a.ChildRegionId,a.CityId)}else{this.city.LoadList(a.RegionId,a.CityId,"city")}}if(this.o.useCityRegion&&a.CityRegionId){this.cityRegion.LoadList(a.CityId,a.CityRegionId)}},values:function(){var a={};a[this.country.hidden.attr("name")]=this.country.hidden.val();a[this.region.hidden.attr("name")]=this.region.hidden.val();a[this.childRegion.hidden.attr("name")]=this.childRegion.hidden.val();a[this.city.hidden.attr("name")]=this.city.hidden.val();if(this.o.useCityRegion){a[this.cityRegion.hidden.attr("name")]=this.cityRegion.hidden.val()}return a}}});define("controls/datetimebox",["common/dnevnik"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.DateTimeBox=function(a,b,c){var d={months:$.d.calendar.localization.lang.months,months_short:$.d.calendar.localization.lang.shortMonths,isHebrew:$.d.calendar.localization.lang.isHebrew,isArabic:$.d.calendar.localization.lang.isArabic,weekdays_short:$.d.calendar.localization.lang.weekdays_short,todayLabel:$.d.calendar.localization.lang.todayLabel};if(b.TodayDate){d.todayDate=b.TodayDate}if(b.FromDate){d.fromDate=b.FromDate}if(b.ToDate){d.toDate=b.ToDate}if(b.StartScreen){d.startScreen=b.StartScreen}if(b.Mode==="ButtonWithRedirect"){var e=b.UrlForButtonWithRedirect.indexOf("?")<0?b.UrlForButtonWithRedirect+"?var":b.UrlForButtonWithRedirect;d.onDateSelected=function(a){window.location.href=e+"&year="+a.year+"&month="+a.month+"&day="+a.day}}else{d.onDateSelected=c?c:function(){return false}}$("#"+a).calendar(d);if(b.Mode==="ButtonWithRedirect"){$("#"+a+"_button").click(function(){$("#"+a).click()})}}});define("controls/captcha",["common/dnevnik"],function(){"use strict";dnevnik.namespace("dnevnik.common.controls");dnevnik.common.controls.captcha=function(){function a(a){var b=dnevnik.utils.guid.getNew();a.inputField.val("");a.idField.val(b);a.img.attr("src",a.imgUrl+b)}return{init:function(b){var c=$("#"+b.inputFieldId),d=$("#"+b.hiddenFieldId),e=$("#"+b.clientId),f=e.find(".captcha_image"),g=e.find(".captcha_refresh_image");g.click(function(){a({inputField:c,idField:d,img:f,imgUrl:b.imgUrl})})}}}()});define("controls/input_phone",[],function(){"use strict";return function(a){var b=a.id,c=document,d=c.getElementById(b),e=_.template("+7 ( <%= this[0] %><%= this[1] %><%= this[2] %> ) <%= this[3] %><%= this[4] %><%= this[5] %><%= this[6] %><%= this[7] %><%= this[8] %><%= this[9] %>"),f=d.getAttribute("value"),g,h,i,j,k,l,m,n;j=function(a){return a.replace(/^\+7|\(|\)|\s|\D/g,"")};k=function(a){a=a||10;return new Array(a).join(" ").split("")};l=function(a){var b=0;var c=j(a).length;if(d.selectionStart||d.selectionStart==="0"){b=d.selectionStart}if(b<5){b=5}else if(b>7&&b<11){if(c<4){b=8}else if(c>=10&&b===8){b=11}else{b=12}}return b};m=function(a){d.setSelectionRange(a,a)};n=function(a){var b=l(a.target.value);m(b)};if(!f){f=e.call(k());d.setAttribute("value",f)}i=function(){var a=d.value;if(a[0]!=="+"){a="+"+a}var b=l(a);var c=j(a);var i=c.split("");var n=i.slice(0,10);var o=e.call(n.concat(k(10-n.length)));f=o;h=c;g=o.length;d.value=o;if(i.length>=10&&b===11&&o[b].match(/^\D/)){b=b-1}else if(i.length<10&&o[b-1].match(/^\D/)){b=b-1}m(b)};d.addEventListener("focus",n);d.addEventListener("click",n);d.addEventListener("keydown",n);d.addEventListener("input",i);i()}});define("controls/dictionaries",[],function(){"use strict";return function(a){var b=document,c=a.ajaxUrl,d=a.errorText,e=b.getElementById("outype"),f=b.getElementById("ouclass"),g=b.getElementById("eduOrgclass"),h,i;h=function(){i()};i=function(){var a=e.value;var b=dnevnik.dialogs;$.ajax({type:"Post",url:c,dataType:"json",data:{a:"eoclass",eotid:a},success:function(a){if(!a.isOrgTypeNew){g.classList.remove("orgclass_hidden")}else{g.classList.add("orgclass_hidden")}f.innerHTML=a.list},error:function(){b.error(d)}})};e.addEventListener("change",h)}});define("controls/controls",["controls/utils","controls/cityselectbox","controls/datetimebox","controls/captcha","controls/input_phone","controls/dictionaries"],function(){"use strict"});define("async/polling",["common/dnevnik"],function(){"use strict";function a(){var a=1e3;var b=0;var c=1;var d=2;var e=3;var f=4;var g=5;var h;var i;var j;var k=function(c){var d=c.taskStatus;if(d===e){if(i&&h.success){h.success()}i=false}if(d===f||d===b||d===g){i=false;if(h.error){h.error(c)}}if(i){setTimeout(function(){m(h)},a)}};var l=function(a,b){if(b&&a&&b.status===403){window.location.replace(a)}else if(h.error){h.error(b)}};var m=function(a){$.ajax({type:"GET",url:a.taskStateHandlerUrl,dataType:"json",async:a.async===undefined?true:a.async,data:{a:"gts",tid:a.taskID}}).done(a.requestCompleted?a.requestCompleted:k).fail(function(b){l(a.loginUrl,b)})};var n=function(a){h=a;j=h.taskID;i=true;m(a)};var o=function(){i=false;j=undefined};var p=function(){return j};var q=function(){return i};return{start:n,cancel:o,status:{TASK_STATUS_UNDEFINED:b,TASK_STATUS_PENDING:c,TASK_STATUS_EXECUTING:d,TASK_STATUS_COMPLETED:e,TASK_STATUS_ERROR:f},getTaskId:p,isPolling:q,request:m}}var b=a();b.ctor=a;return b});define("controls/visualtextbox",["utils/string","smiles/smilesforeditor"],function(a,b){"use strict";return function(c){if(!c.uid){c.uid=c.id}var d="bold italic subscript superscript | bullist numlist | link unlink | image media  table | formatselect ";var e="bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | subscript superscript | bullist numlist "+"| outdent indent | blockquote | link unlink | image media  table code | formatselect";var f=a.format("{0}",c.uid?"."+c.uid:"")+".emoji-selector";var g=a.format("{0}",c.uid?"."+c.uid:"")+".emoji-list-smiles";var h;var i={full:c.isHtmlAllowed==="true"?e:d,simple:a.format("bold bullist {0}",c.isHtmlAllowed==="true"?"code":""),empty:false};var j="1f636,1f635,1f634,1f633,1f632,1f631,1f630,1f62f,1f62e,1f62d,1f62c,1f62b,1f62a,1f629,1f628,1f627,1f626,1f625,1f624,1f623,1f622,1f621,1f620,1f61f,1f61e,1f61d,1f61c,1f61b,1f61a,1f619,1f618,1f617,1f616,1f615,1f614,1f613,1f612,1f611,1f610,1f60f,1f60e,1f60d,1f60c,1f60b,1f60a,1f609,1f608,1f607,1f606,1f606,1f605,1f604,1f603,1f602,1f601,1f600,1f64f,1f64e,1f64d,1f64c,1f64b,1f64a,1f649,1f648,1f647,1f646,1f645,1f640,1f63f,1f63e,1f63d,1f63c,1f63b,1f63a,1f639,1f638,1f637,1f4a9,1f4a8,1f4a7,1f4a6,1f4a5,1f4a4,1f4a3,1f4a2,1f4a1,1f4a0,1f49f,1f49e,1f49d,1f49c,1f49b,1f49a,1f499,1f498,1f497,1f496,1f495,1f494,1f493,1f492,1f491,1f490,1f48f,1f48e,1f48d,1f48c,1f48b,1f48a,1f489,1f488,1f487,1f486,1f485,1f484,1f483,1f482,1f481,1f480,1f480,1f47f,1f47e,1f47d,1f47c,1f47b,1f47a,1f479,1f478,1f477,1f476,1f475,1f475,1f474,1f473,1f472,1f471,1f470,1f46f,1f46e,1f46d,1f46c,1f46b,1f46a,1f469,1f468,1f467,1f466,1f465,1f464,1f463,1f462,1f461,1f460,1f45f,1f45e,1f45d,1f45c,1f45b,1f45a,1f459,1f458,1f457,1f456,1f455,1f454,1f453,1f452,1f451,1f450,1f44f,1f44e,1f44e,1f44d,1f44d,1f44c,1f44b,1f44a,1f449,1f448,1f447,1f446,1f445,1f444,1f443,1f442,1f440,1f43e,1f43d,1f43c,1f43b,1f43a,1f439,1f438,1f437,1f436,1f435,1f434,1f433,1f432,1f431,1f430,1f42f,1f42e,1f42d,1f42c,1f42b,1f42a,1f429,1f428,1f427,1f426,1f425,1f424,1f423,1f422,1f421,1f420,1f41f,1f41e,1f41d,1f41c,1f41b,1f41a,1f419,1f418,1f417,1f416,1f415,1f414,1f413,1f412,1f411,1f410,1f40f,1f40e,1f40d,1f40c,1f40b,1f40a,1f409,1f408,1f407,1f406,1f405,1f404,1f403,1f402,1f401,1f400,27bf,1f6c5,1f6c4,1f6c3,1f6c2,1f6c1,1f6c0,1f6bf,1f6be,1f6bd,1f6bc,1f6bb,1f6ba,1f6b9,1f6b8,1f6b7,1f6b6,1f6b5,1f6b4,1f6b3,1f6b2,1f6b1,1f6b0,1f6af,1f6ae,1f6ad,1f6ac,1f6ab,1f6aa,1f6a9,1f6a8,1f6a7,1f6a6,1f6a5,1f6a4,1f6a3,1f6a2,1f6a1,1f6a0,1f69f,1f69e,1f69d,1f69c,1f69b,1f69a,1f699,1f698,1f697,1f696,1f695,1f694,1f693,1f692,1f691,1f690,1f68f,1f68e,1f68d,1f68c,1f68b,1f68a,1f689,1f688,1f687,1f686,1f685,1f684,1f683,1f682,1f681,1f680,1f5ff,1f5fe,1f5fd,1f5fc,1f5fb,1f552,1f53d,1f53c,1f53b,1f53a,1f539,1f538,1f537,1f536,1f535,1f534,1f533,1f532,1f531,1f530,1f52f,1f52e,1f52d,1f52c,1f52b,1f52a,1f529,1f528,1f527,1f526,1f525,1f525,1f524,1f523,1f522,1f521,1f520,1f51f,1f51e,1f51d,1f51c,1f51b,1f51a,1f519,1f518,1f517,1f516,1f515,1f514,1f513,1f512,1f511,1f510,1f50f,1f50e,1f50d,1f50c,1f50b,1f50a,1f509,1f508,1f507,1f506,1f505,1f504,1f503,1f502,1f501,1f500,1f4fc,1f4fb,1f4f9,1f4f7,1f4f6,1f4f5,1f4f4,1f4f3,1f4f2,1f4f1,1f4f0,1f4ef,1f4ee,1f4ed,1f4ec,1f4eb,1f4ea,1f4e9,1f4e8,1f4e7,1f4e7,1f4e6,1f4e5,1f4e4,1f4e3,1f4e2,1f4e1,1f4e0,1f4df,1f4de,1f4dd,1f4dc,1f4db,1f4da,1f4d9,1f4d8,1f4d7,1f4d6,1f4d5,1f4d4,1f4d3,1f4d2,1f4d1,1f4d0,1f4cf,1f4ce,1f4cd,1f4cc,1f4cb,1f4ca,1f4c9,1f4c8,1f4c7,1f4c6,1f4c5,1f4c4,1f4c3,1f4c2,1f4c1,1f4c0,1f4be,1f4bd,1f4bc,1f4bb,1f4ba,1f4b9,1f4b8,1f4b7,1f4b6,1f4b5,1f4b4,1f4b3,1f4b2,1f4b1,1f4b0,1f4af,1f4ae,1f4ad,1f4ac,1f4ab,1f4aa,1f3f0,1f3ef,1f3ee,1f3ed,1f3ec,1f3eb,1f3ea,1f3e9,1f3e8,1f3e7,1f3e6,1f3e5,1f3e4,1f3e3,1f3e2,1f3e1,1f3e0,1f3ca,1f3c9,1f3c8,1f3c7,1f3c6,1f3c4,1f3c3,1f3c2,1f3c1,1f3c0,1f3bf,1f3be,1f3bd,1f3bc,1f3bb,1f3ba,1f3b9,1f3b8,1f3b7,1f3b6,1f3b5,1f3b4,1f3b3,1f3b2,1f3b1,1f3b0,1f3af,1f3ae,1f3ad,1f3ac,1f3ab,1f3aa,1f3a9,1f3a8,1f3a7,1f3a6,1f3a5,1f3a4,1f3a3,1f3a2,1f3a1,1f3a0,1f393,1f392,1f391,1f390,1f38f,1f38e,1f38d,1f38c,1f38b,1f38a,1f389,1f388,1f387,1f386,1f385,1f384,1f383,1f382,1f381,1f380,1f37c,1f37b,1f37a,1f379,1f378,1f377,1f376,1f375,1f374,1f373,1f372,1f371,1f370,1f36f,1f36e,1f36d,1f36c,1f36b,1f36a,1f369,1f368,1f367,1f366,1f365,1f364,1f363,1f362,1f361,1f360,1f35f,1f35e,1f35d,1f35c,1f35b,1f35a,1f359,1f358,1f357,1f356,1f355,1f354,1f353,1f352,1f351,1f350,1f34f,1f34e,1f34d,1f34c,1f34b,1f34a,1f349,1f348,1f347,1f346,1f345,1f344,1f343,1f342,1f341,1f340,1f33f,1f33e,1f33d,1f33c,1f33b,1f33a,1f339,1f338,1f337,1f335,1f334,1f333,1f332,1f331,1f330,1f320,1f31f,1f31e,1f31d,1f31c,1f31b,1f31a,1f319,1f318,1f317,1f316,1f315,1f314,1f313,1f312,1f311,1f310,1f30f,1f30e,1f30d".split(",");var k=false;var l=b({smilesSpriteUrl:c.smilesSpriteUrl});var m=function(a,b){return a.get(0).scrollHeight>b.height()};var n=function(a,b){return a.get(0).scrollWidth>b.width()};var o=function(a,b){if(m(a,b)){$(h).css({left:"calc(100% - 50px)"})}else{$(h).css({left:"calc(100% - 30px)"})}if(n(a,b)){$(h).css({top:"calc(100% - 50px)"})}else{$(h).css({top:"calc(100% - 30px)"})}};var p=function(){var b="<div class='emoji-list-smiles {1}' >{0}</div>";var d="";for(var e in j){if(j.hasOwnProperty(e)){var f=j[e].toUpperCase();var g="<img class='emojione emojione-"+f+"' alt='"+emojione.convert(f)+"' src='"+c.smilesSpriteUrl+"'/>";d=d+g}}return a.format(b,d,c.uid)};var q=a.format("{0}{1}.visual-textbox",c.cssClass?"."+c.cssClass:"",c.uid?"#"+c.uid:"");var r=function(){var a=tinyMCE.get(c.uid);var b=$(a.getContainer());$(g).css({left:b.position().left+$(h).position().left,top:b.position().top+$(h).position().top+25})};tinyMCE.baseURL=dnevnik.urls.tinyMceBaseUrl;tinyMCE.suffix=".min";tinyMCE.init({relative_urls:false,remove_script_host:false,convert_urls:true,selector:q,theme:"modern",menubar:false,language:c.language,image_advtab:true,statusbar:false,skin:"dnevnik",readonly:c.readonly==="true",plugins:["advlist autolink link image lists print preview","visualchars code fullscreen media noneditable nonbreaking","save table template paste"],toolbar:i[c.toolbarType],valid_children:"+body[style]",width:c.width,height:c.height,object_resizing:":not(.emojione)",paste_as_text:c.pasteAsText==="true"?true:false,content_css:c.contentcss,setup:function(b){b.on("LoadContent",function(){var c=tinyMCE.ui.Factory.create({type:"button",classes:"emoji-button"}).renderTo(b.editorContainer);h=a.format("#{0} .mce-emoji-button button",$(b.getContainer()).attr("id"));o($(b.iframeElement).contents().find(".mce-content-body"),$(b.iframeElement));c.on("click",function(){if(!k){$(f).html(p);$(document).click(function(a){if($(a.target).is("#emoji-list-smiles, #emoji-list-smiles *,.mce-emoji-button, .mce-emoji-button *")){return}$(f).hide()});$(g).find("img").bind("click",function(){b.insertContent(this.outerHTML);$(f).toggle()});k=true}$(f).toggle();r()});var d=b.getContent();var e=l.convertTo(d).content;b.setContent(e)});b.on("change",function(){setTimeout(function(){var a=b.getContent();var c=l.convertTo(a);if(c.contentChanged){var d=b.selection.getBookmark(2,true),e=1;var f=b.selection.getRng(true).startContainer;if(f.nodeType===3&&!_.has(emojione.asciiList,f.nodeValue)){e=2}b.setContent(c.content);d.start.shift();d.start[0]+=e;b.selection.moveToBookmark(d)}o($(b.iframeElement).contents().find(".mce-content-body"),$(b.iframeElement));r()},0)});b.on("SaveContent",function(a){a.content=l.convertFrom(a.content)});b.settings.block_formats="Heading 1=h1;"+"Heading 2=h2;"+"Heading 3=h3;"+"Paragraph=p"}})}});define("controls/export",["async/polling"],function(){"use strict";var a=arguments[0];var b={};var c=function(c){var d=$("#"+b.modalWindowID),e=$(b.mask),f=$("div.wrapper form",d),g=$("div",f),h=$("img",f);var i=function(a){if(a&&a.status===403){window.location.replace(b.loginUrl)}else{h.hide();g.html(b.errorMessage)}};var j=function(){$.ajax({type:"GET",url:b.handlerUrl,dataType:"json",data:$.extend({a:b.getResultAction,tid:a.getTaskId()},b.data)}).done(function(c){if(c.error){h.hide();g.html(c.error)}else{if(a.getTaskId()){document.location=b.handlerUrl+"?"+$.param($.extend({tid:a.getTaskId(),a:b.getFileAction},b.data))}d.hide();e.hide();if(c.notExportedGroups&&c.notExportedGroups.length>0){h.hide();dnevnik.dialogs.error(b.notExportedMessage+" "+c.notExportedGroups.join())}}})};var k=function(c){a.start({taskID:c.taskID,taskStateHandlerUrl:b.taskStateHandlerUrl,success:j,loginUrl:b.loginUrl,error:function(a){i(a)}})};b.data=c;$("#cancelButton").click(function(){a.cancel();d.hide();e.hide()});d.show();h.show();e.show();g.html(b.waitText);$.ajax({type:"GET",url:b.handlerUrl,dataType:"json",data:$.extend({a:b.scheduleExportAction},b.data)}).done(k).fail(function(a){i(a)})};var d=function(a){b.modalWindowID=a.modalWindowID;b.waitText=a.waitText;b.errorMessage=a.errorMessage;b.notExportedMessage=a.notExportedMessage;b.mask=a.maskSelector;b.scheduleExportAction=a.scheduleExportAction;b.getFileAction=a.getFileAction;b.getResultAction=a.getResultAction;b.handlerUrl=a.reportsHandlerUrl;b.taskStateHandlerUrl=a.taskStateHandlerUrl;b.loginUrl=a.loginUrl};return{load:d,initBuilding:c}});require(["common/dnevnik","common/pubsub","analytics/analytics","dialogs/dialogs","messageBox/messageBox","utils/utils","lazy/lazy","controls/controls","async/polling","controls/visualtextbox","controls/export"],function(){"use strict";$.ajaxSetup({cache:false})});define("main",function(){});